---
title: "Research"
title-block-banner: false
---

```{r setup}
#| message: false
#| echo: false
#| warning: false
source("functions.R")
```

```{r importing pubs}
#| message: false
#| echo: false
#| warning: false

pubs <- get_cv_sheet('pubs') |>
  mutate(
    journal  = ifelse(is.na(journal_abbv), '', paste0('<u>**', journal_abbv, '**</u>')),
    number   = ifelse(is.na(number), '', paste0(number, '.')),
    doi      = case_when(is.na(doi) ~ '',
                         doi == 'Submitted under consideration' ~ doi,
                         TRUE ~ paste0('<a href="https://doi.org/', doi, '" target="_blank"><i class="fa-solid fa-link"></i> DOI</a>')
       ),
    year_num = year,
    year     = paste0("(", year, ")"),
    title_clean = title,
    title    = enquote(title),
    conference = ifelse(is.na(conference_name), '', paste0('<u>**', conference_name, '**</u>')),
    organization = ifelse(is.na(organization_name), '', paste0(organization_name, '.')),
  ) |>
  arrange(desc(year_num))
```

::: {.featured-section}
## Featured Publications

```{r featured pubs}
#| message: false
#| echo: false
#| warning: false
#| results: asis

# Get only those the featrured column is TRUE
featured <- pubs |>
  filter(category == "peer_reviewed") |>
  filter(featured == TRUE)

for(i in 1:nrow(featured)) {
  pub <- featured[i,]
  card <- make_publication_card(
    author = pub$author,
    year = pub$year,
    title = pub$title_clean,
    journal = pub$journal,
    number = pub$number,
    doi = pub$doi,
    category = pub$category
  )
  cat(card, "\n\n")
}
```
:::

## All Publications

::: {.publications-grid}

### Peer-Reviewed Articles

```{r all peer-reviewed}
#| message: false
#| echo: false
#| warning: false
#| results: asis

all_peer <- pubs |> filter(category == "peer_reviewed")

for(i in 1:nrow(all_peer)) {
  pub <- all_peer[i,]
  card <- make_publication_card(
    author = pub$author,
    year = pub$year,
    title = pub$title_clean,
    journal = pub$journal,
    number = pub$number,
    doi = pub$doi,
    category = pub$category
  )
  cat(card, "\n\n")
}
```

### Preprints

```{r preprints}
#| message: false
#| echo: false
#| warning: false
#| results: asis

preprints <- pubs |> filter(category == "working")

if(nrow(preprints) > 0) {
  for(i in 1:nrow(preprints)) {
    pub <- preprints[i,]
    card <- make_publication_card(
      author = pub$author,
      year = pub$year,
      title = pub$title_clean,
      journal = pub$journal,
      number = pub$number,
      doi = pub$doi,
      category = pub$category
    )
    cat(card, "\n\n")
  }
}
```

### Policy Statements & Reports

```{r white papers}
#| message: false
#| echo: false
#| warning: false
#| results: asis

reports <- pubs |> filter(category == "white_paper")

if(nrow(reports) > 0) {
  for(i in 1:nrow(reports)) {
    pub <- reports[i,]
    # Simpler card for white papers (no journal)
    year_clean <- gsub("[()]", "", pub$year)
    card <- paste0(
      '<div class="publication-card">',
      '<div class="pub-header">',
      '<div class="pub-badges">',
      '<span class="pub-badge pub-year">', year_clean, '</span> ',
      '<span class="pub-badge pub-category">Report</span>',
      '</div></div>',
      '<h3 class="pub-title">', gsub('"', '', pub$title), '</h3>',
      '<p class="pub-authors">', pub$author, '</p>',
      '<p class="pub-venue">', pub$organization_name, ', ', pub$place, '</p>',
      '</div>'
    )
    cat(card, "\n\n")
  }
}
```

### Theses

```{r theses}
#| message: false
#| echo: false
#| warning: false
#| results: asis

theses <- pubs |> filter(category == "thesis")

if(nrow(theses) > 0) {
  for(i in 1:nrow(theses)) {
    pub <- theses[i,]
    year_clean <- gsub("[()]", "", pub$year)
    card <- paste0(
      '<div class="publication-card">',
      '<div class="pub-header">',
      '<div class="pub-badges">',
      '<span class="pub-badge pub-year">', year_clean, '</span> ',
      '<span class="pub-badge pub-category">Thesis</span>',
      '</div></div>',
      '<h3 class="pub-title">', gsub('"', '', pub$title), '</h3>',
      '<p class="pub-authors">', pub$author, '</p>',
      '<p class="pub-venue">', pub$journal, ' • ', pub$organization, '</p>',
      '</div>'
    )
    cat(card, "\n\n")
  }
}
```

### Conference Abstracts

```{r conference}
#| message: false
#| echo: false
#| warning: false
#| results: asis

conferences <- pubs |> filter(category == "conference")

if(nrow(conferences) > 0) {
  for(i in 1:nrow(conferences)) {
    pub <- conferences[i,]
    year_clean <- gsub("[()]", "", pub$year)
    card <- paste0(
      '<div class="publication-card">',
      '<div class="pub-header">',
      '<div class="pub-badges">',
      '<span class="pub-badge pub-year">', year_clean, '</span> ',
      '<span class="pub-badge pub-category">Conference</span>',
      '</div></div>',
      '<h3 class="pub-title">', gsub('"', '', pub$title), '</h3>',
      '<p class="pub-authors">', pub$author, '</p>',
      '<p class="pub-venue">', pub$conference, ' • ', pub$organization, ', ', pub$place, '</p>',
      '</div>'
    )
    cat(card, "\n\n")
  }
}
```

:::